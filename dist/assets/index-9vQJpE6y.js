(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class b{constructor(){this.state={currentGame:null,isMuted:this.loadMuteState(),score:0,unlockedLevels:{}},this.subscribers=new Map}getState(){return{...this.state}}setState(e){const t={...this.state};this.state={...this.state,...e},Object.keys(e).forEach(n=>{this.subscribers.has(n)&&this.subscribers.get(n).forEach(s=>{s(this.state[n],t[n])})}),"isMuted"in e&&this.saveMuteState(e.isMuted)}subscribe(e,t){return this.subscribers.has(e)||this.subscribers.set(e,new Set),this.subscribers.get(e).add(t),()=>{this.subscribers.get(e).delete(t)}}loadMuteState(){try{return localStorage.getItem("toddlerGamesMuted")==="true"}catch{return!1}}saveMuteState(e){try{localStorage.setItem("toddlerGamesMuted",e.toString())}catch(t){console.error("Failed to save mute state:",t)}}}const C=new b;class M{constructor(){this.audioContext=null,this.isMuted=C.getState().isMuted,C.subscribe("isMuted",e=>{this.isMuted=e})}init(){if(!this.audioContext)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn("AudioContext not available:",e);return}this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume().catch(()=>{})}playMagicalChime(){if(this.isMuted)return;this.init();const e=[523.25,659.25,783.99,1046.5,1318.51],t=[.5,.3,.2,.15,.1];e.forEach((n,s)=>{const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.audioContext.destination),i.frequency.value=n,i.type="sine";const o=this.audioContext.currentTime+s*.08;a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.4*t[s],o+.03),a.gain.exponentialRampToValueAtTime(.01,o+.5),i.start(o),i.stop(o+.5);const r=this.audioContext.createOscillator(),c=this.audioContext.createGain();r.connect(c),c.connect(this.audioContext.destination),r.frequency.value=n*2,r.type="triangle",c.gain.setValueAtTime(0,o),c.gain.linearRampToValueAtTime(.1*t[s],o+.02),c.gain.exponentialRampToValueAtTime(.01,o+.3),r.start(o),r.stop(o+.3)})}playPop(){if(this.isMuted)return;this.init();const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(600,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.1),t.gain.setValueAtTime(.3,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.1)}playThud(){if(this.isMuted)return;this.init();const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(150,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.15),t.gain.setValueAtTime(.4,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.15)}playSuccess(){if(this.isMuted)return;this.init(),[523.25,659.25,783.99,1046.5].forEach((t,n)=>{const s=this.audioContext.createOscillator(),i=this.audioContext.createGain();s.connect(i),i.connect(this.audioContext.destination),s.frequency.value=t,s.type="sine";const a=this.audioContext.currentTime+n*.1;i.gain.setValueAtTime(0,a),i.gain.linearRampToValueAtTime(.3,a+.05),i.gain.exponentialRampToValueAtTime(.01,a+.3),s.start(a),s.stop(a+.3)})}playAnimalSound(e){if(this.isMuted)return;this.init();const t={dog:()=>this.barkSound(),cat:()=>this.meowSound(),cow:()=>this.mooSound(),duck:()=>this.quackSound(),sheep:()=>this.baaSound(),pig:()=>this.oinkSound()};t[e]&&t[e]()}barkSound(){const e=this.audioContext.currentTime;for(let t=0;t<2;t++){const n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.connect(s),s.connect(this.audioContext.destination),n.type="sawtooth",n.frequency.setValueAtTime(300,e+t*.15),n.frequency.exponentialRampToValueAtTime(200,e+t*.15+.1),s.gain.setValueAtTime(.3,e+t*.15),s.gain.exponentialRampToValueAtTime(.01,e+t*.15+.1),n.start(e+t*.15),n.stop(e+t*.15+.1)}}meowSound(){const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),n=this.audioContext.createGain();t.connect(n),n.connect(this.audioContext.destination),t.type="triangle",t.frequency.setValueAtTime(600,e),t.frequency.linearRampToValueAtTime(800,e+.2),t.frequency.linearRampToValueAtTime(400,e+.4),n.gain.setValueAtTime(.3,e),n.gain.linearRampToValueAtTime(.2,e+.2),n.gain.linearRampToValueAtTime(.01,e+.4),t.start(e),t.stop(e+.4)}mooSound(){const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),n=this.audioContext.createGain();t.connect(n),n.connect(this.audioContext.destination),t.type="sawtooth",t.frequency.setValueAtTime(200,e),t.frequency.linearRampToValueAtTime(150,e+.3),t.frequency.linearRampToValueAtTime(180,e+.6),n.gain.setValueAtTime(.4,e),n.gain.linearRampToValueAtTime(.3,e+.3),n.gain.linearRampToValueAtTime(.01,e+.8),t.start(e),t.stop(e+.8)}quackSound(){const e=this.audioContext.currentTime;for(let t=0;t<2;t++){const n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.connect(s),s.connect(this.audioContext.destination),n.type="square",n.frequency.setValueAtTime(400,e+t*.12),n.frequency.exponentialRampToValueAtTime(300,e+t*.12+.08),s.gain.setValueAtTime(.3,e+t*.12),s.gain.exponentialRampToValueAtTime(.01,e+t*.12+.08),n.start(e+t*.12),n.stop(e+t*.12+.08)}}baaSound(){const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),n=this.audioContext.createGain();t.connect(n),n.connect(this.audioContext.destination),t.type="sawtooth",t.frequency.setValueAtTime(350,e),t.frequency.linearRampToValueAtTime(300,e+.15),t.frequency.linearRampToValueAtTime(320,e+.3),n.gain.setValueAtTime(.3,e),n.gain.linearRampToValueAtTime(.2,e+.15),n.gain.linearRampToValueAtTime(.01,e+.5),t.start(e),t.stop(e+.5)}oinkSound(){const e=this.audioContext.currentTime;for(let t=0;t<3;t++){const n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.connect(s),s.connect(this.audioContext.destination),n.type="sawtooth",n.frequency.setValueAtTime(250,e+t*.15),n.frequency.exponentialRampToValueAtTime(200,e+t*.15+.1),s.gain.setValueAtTime(.3,e+t*.15),s.gain.exponentialRampToValueAtTime(.01,e+t*.15+.1),n.start(e+t*.15),n.stop(e+t*.15+.1)}}}const d=new M;class A{constructor(){this.synth=null,this.frenchVoice=null,this.isMuted=C.getState().isMuted,this.isInitialized=!1,this.audioCache={},C.subscribe("isMuted",e=>{this.isMuted=e,e&&this.stop()})}getTTSUrl(e){return`https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=fr&q=${encodeURIComponent(e)}`}init(){this.isInitialized||("speechSynthesis"in window&&(this.synth=window.speechSynthesis),this.isInitialized=!0,this.loadVoices(),this.synth&&this.synth.onvoiceschanged!==void 0&&(this.synth.onvoiceschanged=()=>this.loadVoices()))}loadVoices(){if(this.synth)try{const t=this.synth.getVoices().filter(n=>n.lang&&(n.lang.includes("fr")||n.lang.includes("FR")));if(t.length>0){const n=["Google franÃ§ais","Thomas","Audrey","AmÃ©lie"];this.frenchVoice=t.find(s=>n.some(i=>s.name.includes(i)))||t[0]}else this.frenchVoice=null}catch(e){console.error("Error loading voices:",e)}}speak(e,t={}){if(this.isMuted)return;let n=!1;if(this.synth&&this.frenchVoice)try{this.synth.cancel();const s=new SpeechSynthesisUtterance(e);s.voice=this.frenchVoice,s.lang="fr-FR",s.pitch=t.pitch||1.1,s.rate=t.rate||.9,s.onerror=i=>{i.error!=="canceled"&&i.error!=="interrupted"&&this.speakFallback(e)},this.synth.speak(s),n=!0}catch(s){console.error("Native speech error:",s)}n||this.speakFallback(e)}speakFallback(e){if(this.audioCache[e]){this.playAudio(this.audioCache[e]);return}const t=this.getTTSUrl(e),n=new Audio(t);n.onloadeddata=()=>{this.audioCache[e]=n,this.playAudio(n)},n.onerror=()=>{d.playPop()},n.load(),this.audioCache[e]=n}playAudio(e){try{e.currentTime=0;const t=e.play();t&&t.catch(n=>console.error("Play failed:",n))}catch(t){console.error("Play exception:",t)}}speakPositive(){const e=["Bravo !","TrÃ¨s bien !","Excellent !","Super !","GÃ©nial !","Parfait !"],t=e[Math.floor(Math.random()*e.length)];this.speak(t)}stop(){this.synth&&this.synth.cancel()}unlock(){if(this.synth||this.init(),this.synth){const e=new SpeechSynthesisUtterance("");this.synth.speak(e)}}}const p=new A;class S{constructor(){this.canvas=null,this.ctx=null,this.particles=[],this.isAnimating=!1,this.colors=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffa500","#ff69b4"]}init(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="confettiCanvas",this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.pointerEvents="none",this.canvas.style.zIndex="9999",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()))}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight)}burst(e,t,n=30){this.canvas||this.init();for(let s=0;s<n;s++)this.particles.push({x:e,y:t,vx:(Math.random()-.5)*15,vy:(Math.random()-.5)*15-5,color:this.colors[Math.floor(Math.random()*this.colors.length)],size:Math.random()*10+5,rotation:Math.random()*360,rotationSpeed:(Math.random()-.5)*10,life:1,decay:.02+Math.random()*.02});this.isAnimating||this.animate()}burstCenter(){this.burst(window.innerWidth/2,window.innerHeight/2,50)}animate(){this.isAnimating=!0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e=this.particles.length-1;e>=0;e--){const t=this.particles[e];if(t.x+=t.vx,t.y+=t.vy,t.vy+=.3,t.rotation+=t.rotationSpeed,t.life-=t.decay,t.life<=0){this.particles.splice(e,1);continue}this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation*Math.PI/180),this.ctx.globalAlpha=t.life,this.ctx.fillStyle=t.color,this.ctx.fillRect(-t.size/2,-t.size/2,t.size,t.size),this.ctx.restore()}this.particles.length>0?requestAnimationFrame(()=>this.animate()):(this.isAnimating=!1,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))}}const y=new S;class w{constructor(e){this.id=e.id,this.name=e.name,this.icon=e.icon,this.container=null,this.eventListeners=[]}mount(e){this.container=e}unmount(){this.cleanup(),this.container&&(this.container.innerHTML="",this.container=null)}cleanup(){this.eventListeners.forEach(({element:e,type:t,handler:n})=>{try{e&&e.removeEventListener&&e.removeEventListener(t,n)}catch(s){console.error("Error removing event listener:",s)}}),this.eventListeners=[]}addEventListener(e,t,n,s){e.addEventListener(t,n,s),this.eventListeners.push({element:e,type:t,handler:n})}getAssets(){return[]}pause(){}resume(){}}class F extends w{constructor(){super({id:"balloonPop",name:"Balloon Pop",icon:"ğŸˆ"}),this.balloons=[],this.spawnInterval=null,this.balloonContainer=null,this.balloonColors=[{color:"#FF6B6B",nameFr:"Rouge"},{color:"#0c67c3ff",nameFr:"Bleu"},{color:"#FFE66D",nameFr:"Jaune"},{color:"#26e472ff",nameFr:"Vert"},{color:"#000000ff",nameFr:"Noir"},{color:"#AA96DA",nameFr:"Violet"},{color:"#FCBAD3",nameFr:"Rose"},{color:"#ffffffff",nameFr:"Blanc"}]}mount(e){super.mount(e),this.container.innerHTML="",this.balloons=[];const t=document.createElement("div");t.className="balloon-game-area";const n=document.createElement("div");n.className="balloon-instruction",n.textContent="ğŸˆ Ã‰clate les ballons!",t.appendChild(n);const s=document.createElement("div");s.className="balloon-container",this.balloonContainer=s,t.appendChild(s),this.container.appendChild(t),this.spawnBalloon(),this.spawnInterval=setInterval(()=>{this.spawnBalloon()},1500),d.playPop(),p.speak("Ã‰clate les ballons!")}spawnBalloon(){if(!this.balloonContainer)return;const e=this.balloonColors[Math.floor(Math.random()*this.balloonColors.length)],t=document.createElement("div");t.className="balloon",t.style.backgroundColor=e.color;const n=5+Math.random()*80;t.style.left=`${n}%`,t.style.bottom="-120px",t.dataset.colorName=e.nameFr;const s=i=>{i.preventDefault(),i.stopPropagation(),this.popBalloon(t)};window.PointerEvent?this.addEventListener(t,"pointerdown",s):(this.addEventListener(t,"touchstart",i=>{i.preventDefault(),s(i)},{passive:!1}),this.addEventListener(t,"click",s)),this.balloonContainer.appendChild(t),this.balloons.push({element:t,speed:2+Math.random()*5,popped:!1}),this.animateBalloon(this.balloons[this.balloons.length-1])}animateBalloon(e){const t=()=>{if(e.popped||!this.balloonContainer)return;const s=(parseFloat(e.element.style.bottom)||-120)+e.speed;if(s>window.innerHeight+100){e.element.remove(),e.popped=!0;return}e.element.style.bottom=`${s}px`,e.animationFrame=requestAnimationFrame(t)};e.animationFrame=requestAnimationFrame(t)}popBalloon(e){const t=this.balloons.find(s=>s.element===e);if(!t||t.popped)return;t.popped=!0,t.animationFrame&&cancelAnimationFrame(t.animationFrame),d.playPop(),p.speak(e.dataset.colorName);const n=e.getBoundingClientRect();y.burst(n.left+n.width/2,n.top+n.height/2,25),e.style.transform="scale(1.3)",e.style.opacity="0",setTimeout(()=>{e.remove()},200)}cleanup(){this.spawnInterval&&(clearInterval(this.spawnInterval),this.spawnInterval=null),this.balloons.forEach(e=>{e.animationFrame&&cancelAnimationFrame(e.animationFrame)}),this.balloons=[],this.balloonContainer=null,super.cleanup()}}class k extends w{constructor(){super({id:"musicalPiano",name:"Musical Piano",icon:"ğŸ¹"}),this.audioContext=null,this.keys=[{note:"C",freq:261.63,color:"#FF6B6B",colorName:"Rouge"},{note:"D",freq:293.66,color:"#4ECDC4",colorName:"Turquoise"},{note:"E",freq:329.63,color:"#FFE66D",colorName:"Jaune"},{note:"F",freq:349.23,color:"#95E1D3",colorName:"Vert"},{note:"G",freq:392,color:"#AA96DA",colorName:"Violet"}]}mount(e){super.mount(e),this.container.innerHTML="",this.initAudioContext();const t=document.createElement("div");t.className="piano-game-wrapper";const n=document.createElement("div");n.className="piano-instruction",n.textContent="ğŸ¹ Joue du piano!",t.appendChild(n);const s=document.createElement("div");s.className="piano-container",this.keys.forEach(i=>{const a=document.createElement("button");a.className="piano-key",a.style.backgroundColor=i.color,a.dataset.note=i.note,a.dataset.freq=i.freq,a.dataset.colorName=i.colorName;const o=document.createElement("span");o.className="piano-note-label",o.textContent=i.note,a.appendChild(o);const r=c=>{c.preventDefault(),c.stopPropagation(),this.playKey(i,a)};window.PointerEvent?this.addEventListener(a,"pointerdown",r):(this.addEventListener(a,"touchstart",c=>{c.preventDefault(),r(c)},{passive:!1}),this.addEventListener(a,"click",r)),s.appendChild(a)}),t.appendChild(s),this.container.appendChild(t),d.playPop(),p.speak("Joue du piano!")}initAudioContext(){try{const e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e)}catch(e){console.error("Could not create AudioContext:",e)}}playKey(e,t){t.classList.add("piano-key-active"),setTimeout(()=>{t.classList.remove("piano-key-active")},200),this.audioContext||this.initAudioContext(),this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume(),this.playTone(e.freq);const n=t.getBoundingClientRect();y.burst(n.left+n.width/2,n.top,15)}playTone(e){if(!this.audioContext){d.playPop();return}try{this.audioContext.state==="suspended"&&this.audioContext.resume();const t=this.audioContext.createOscillator(),n=this.audioContext.createGain();t.connect(n),n.connect(this.audioContext.destination),t.frequency.value=e,t.type="sine",n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.05),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.5)}catch(t){console.error("Error playing tone:",t),d.playPop()}}cleanup(){if(this.audioContext){try{this.audioContext.close()}catch(e){console.error("Error closing AudioContext:",e)}this.audioContext=null}super.cleanup()}}class N extends w{constructor(){super({id:"colorSorter",name:"Color Sorter",icon:"ğŸ—‘ï¸"}),this.score=0,this.balls=[],this.buckets=[],this.ballSpawnInterval=null,this.draggedBall=null,this.ballsArea=null,this.scoreDisplay=null,this.colors=[{name:"red",nameFr:"Rouge",color:"#FF6B6B",emoji:"ğŸ”´"},{name:"blue",nameFr:"Bleu",color:"#006feeff",emoji:"ğŸ”µ"},{name:"green",nameFr:"Vert",color:"#95E1D3",emoji:"ğŸŸ¢"}]}mount(e){super.mount(e),this.container.innerHTML="",this.score=0,this.balls=[];const t=document.createElement("div");t.className="sorter-game-wrapper";const n=document.createElement("div");n.className="sorter-score",n.textContent=`Score: ${this.score}`,this.scoreDisplay=n,t.appendChild(n);const s=document.createElement("div");s.className="sorter-instruction",s.textContent="ğŸ—‘ï¸ Trie les balles par couleur!",t.appendChild(s);const i=document.createElement("div");i.className="sorter-buckets-area",this.colors.forEach(o=>{const r=document.createElement("div");r.className="sorter-bucket",r.style.backgroundColor=o.color,r.dataset.color=o.name,r.dataset.colorFr=o.nameFr;const c=document.createElement("span");c.className="sorter-bucket-label",c.textContent=o.nameFr,r.appendChild(c),i.appendChild(r)}),t.appendChild(i);const a=document.createElement("div");a.className="sorter-balls-area",this.ballsArea=a,t.appendChild(a),this.container.appendChild(t),this.buckets=Array.from(i.querySelectorAll(".sorter-bucket")),this.spawnBall(),this.ballSpawnInterval=setInterval(()=>{this.spawnBall()},2e3),d.playPop(),p.speak("Trie les balles par couleur!")}spawnBall(){if(!this.ballsArea||this.balls.length>=5)return;const e=this.colors[Math.floor(Math.random()*this.colors.length)],t=document.createElement("div");t.className="sorter-ball",t.style.backgroundColor=e.color,t.textContent=e.emoji,t.dataset.color=e.name,t.dataset.colorFr=e.nameFr;const n=10+Math.random()*80;t.style.left=`${n}%`,t.style.top="20px",this.addDragHandlers(t),this.ballsArea.appendChild(t),this.balls.push({element:t,popped:!1})}addDragHandlers(e){let t,n,s,i,a=!1,o=null;const r=l=>l.clientX!==void 0?{x:l.clientX,y:l.clientY}:l.touches&&l.touches.length>0?{x:l.touches[0].clientX,y:l.touches[0].clientY}:l.changedTouches&&l.changedTouches.length>0?{x:l.changedTouches[0].clientX,y:l.changedTouches[0].clientY}:null,c=l=>{if(l.preventDefault(),this.draggedBall&&this.draggedBall!==e)return;const u=r(l);if(!u)return;a=!0,this.draggedBall=e,o=l.pointerId,t=u.x,n=u.y;const g=e.getBoundingClientRect();s=g.left,i=g.top,e.style.position="fixed",e.style.left=s+"px",e.style.top=i+"px",e.style.zIndex="1000",e.style.transform="scale(1.2)",l.target&&l.target.setPointerCapture&&l.target.setPointerCapture(l.pointerId),d.playPop()},m=l=>{if(!a||!this.draggedBall||this.draggedBall!==e||o!==null&&l.pointerId!==o)return;l.preventDefault();const u=r(l);if(!u)return;const g=u.x-t,x=u.y-n;e.style.left=s+g+"px",e.style.top=i+x+"px"},v=l=>{if(!a||!this.draggedBall||this.draggedBall!==e||o!==null&&l.pointerId!==o)return;if(a=!1,o=null,l.target&&l.target.releasePointerCapture)try{l.target.releasePointerCapture(l.pointerId)}catch{}const u=e.getBoundingClientRect(),g={x:u.left+u.width/2,y:u.top+u.height/2};let x=!1,T=null;this.buckets.forEach(E=>{const L=E.getBoundingClientRect();g.x>=L.left&&g.x<=L.right&&g.y>=L.top&&g.y<=L.bottom&&(T=E,E.dataset.color===e.dataset.color&&(x=!0))}),x?this.handleSuccess(e,T):T?this.handleFailure(e):this.returnBall(e),this.draggedBall=null},h=l=>{l.preventDefault(),c(l)};window.PointerEvent?(this.addEventListener(e,"pointerdown",c),this.addEventListener(document,"pointermove",m),this.addEventListener(document,"pointerup",v),this.addEventListener(document,"pointercancel",v)):(this.addEventListener(e,"touchstart",h,{passive:!1}),this.addEventListener(document,"touchmove",m,{passive:!1}),this.addEventListener(document,"touchend",v),this.addEventListener(document,"touchcancel",v))}handleSuccess(e,t){this.score+=10,this.updateScoreDisplay(),d.playSuccess(),p.speak(e.dataset.colorFr);const n=t.getBoundingClientRect();y.burst(n.left+n.width/2,n.top+n.height/2,30),e.style.transform="scale(0)",setTimeout(()=>{e.remove();const s=this.balls.findIndex(i=>i.element===e);s>-1&&this.balls.splice(s,1)},200)}handleFailure(e){d.playThud(),e.style.animation="sorterBallShake 0.5s ease",setTimeout(()=>{e.style.animation="",this.returnBall(e)},500)}returnBall(e){e.style.position="absolute",e.style.left="10%",e.style.top="20px",e.style.zIndex="",e.style.transform="scale(1)"}updateScoreDisplay(){this.scoreDisplay&&(this.scoreDisplay.textContent=`Score: ${this.score}`)}cleanup(){this.ballSpawnInterval&&(clearInterval(this.ballSpawnInterval),this.ballSpawnInterval=null),this.draggedBall=null,this.balls=[],super.cleanup()}}class B extends w{constructor(){super({id:"animalSounds",name:"Animal Sounds",icon:"ğŸ¶"}),this.animals=[{emoji:"ğŸ¶",type:"dog",nameFr:"Le chien",color:"#FFE4B5"},{emoji:"ğŸ±",type:"cat",nameFr:"Le chat",color:"#FFB6C1"},{emoji:"ğŸ®",type:"cow",nameFr:"La vache",color:"#F5DEB3"},{emoji:"ğŸ¦†",type:"duck",nameFr:"Le canard",color:"#FFFFE0"},{emoji:"ğŸ‘",type:"sheep",nameFr:"Le mouton",color:"#FFFAF0"},{emoji:"ğŸ·",type:"pig",nameFr:"Le cochon",color:"#FFC0CB"}]}mount(e){super.mount(e),this.container.innerHTML="";const t=document.createElement("div");t.className="animal-grid",this.animals.forEach(n=>{const s=document.createElement("div");s.className="animal-card",s.textContent=n.emoji,s.style.backgroundColor=n.color;const i=a=>this.handleAnimalClick(a,s,n);this.addEventListener(s,"click",i),this.addEventListener(s,"touchstart",a=>{a.preventDefault(),i(a)}),t.appendChild(s)}),this.container.appendChild(t)}handleAnimalClick(e,t,n){if(t.classList.contains("animating"))return;p.speak(n.nameFr),d.playAnimalSound(n.type),t.classList.add("animating");const s=t.getBoundingClientRect();y.burst(s.left+s.width/2,s.top+s.height/2,20),setTimeout(()=>{t.classList.remove("animating")},500)}cleanup(){super.cleanup()}}class P extends w{constructor(){super({id:"shapeMatch",name:"Shape Match",icon:"ğŸ”º"}),this.currentLevel=1,this.maxLevels=4,this.score=0,this.draggedElement=null,this.originalPosition={},this.matchedCount=0,this.isTransitioning=!1,this.moveHandler=null,this.endHandler=null,this.levelConfig={1:[{emoji:"ğŸ”´",type:"circle",nameFr:"Le cercle",color:"#ff6b6b"}],2:[{emoji:"ğŸ”´",type:"circle",nameFr:"Le cercle",color:"#ff6b6b"},{emoji:"ğŸŸ¦",type:"square",nameFr:"Le carrÃ©",color:"#4ecdc4"}],3:[{emoji:"ğŸ”´",type:"circle",nameFr:"Le cercle",color:"#ff6b6b"},{emoji:"ğŸŸ¦",type:"square",nameFr:"Le carrÃ©",color:"#4ecdc4"},{emoji:"ğŸ”º",type:"triangle",nameFr:"Le triangle",color:"#ffe66d"}],4:[{emoji:"ğŸ”´",type:"circle",nameFr:"Le cercle",color:"#ff6b6b"},{emoji:"ğŸŸ¦",type:"square",nameFr:"Le carrÃ©",color:"#4ecdc4"},{emoji:"ğŸ”º",type:"triangle",nameFr:"Le triangle",color:"#ffe66d"},{emoji:"â­",type:"star",nameFr:"L'Ã©toile",color:"#ffd700"}]}}get shapes(){return this.levelConfig[this.currentLevel]||this.levelConfig[1]}mount(e){super.mount(e),this.container.innerHTML="",this.draggedElement=null,this.matchedCount=0,this.isTransitioning=!1;const t=document.createElement("div");t.className="shape-game-wrapper";const n=document.createElement("div");n.className="score-hud",n.innerHTML=`
      <div class="score-display">Score: ${this.score}</div>
      <div class="level-display">Level ${this.currentLevel}</div>
    `,t.appendChild(n);const s=document.createElement("div");s.className="level-complete-message",s.textContent="Niveau suivant!",t.appendChild(s);const i=document.createElement("div");i.className="shape-game-container";const a=document.createElement("div");a.className="targets-area";const o=document.createElement("div");o.className="shapes-area";const r=[...this.shapes].sort(()=>Math.random()-.5);this.shapes.forEach(c=>{const m=document.createElement("div");m.className="shape-target",m.dataset.shape=c.type,m.innerHTML=`<span class="shape-outline">${c.emoji}</span>`,a.appendChild(m)}),r.forEach((c,m)=>{const v=document.createElement("div");v.className="draggable-shape",v.textContent=c.emoji,v.dataset.shape=c.type,this.originalPosition[c.type]=m,this.addDragHandlers(v),o.appendChild(v)}),i.appendChild(a),i.appendChild(o),t.appendChild(i),this.container.appendChild(t),d.playPop()}addDragHandlers(e){const t=s=>this.handleStart(s,e);this.addEventListener(e,"pointerdown",t);const n=s=>{s.preventDefault(),this.handleStart(s,e)};this.addEventListener(e,"touchstart",n,{passive:!1})}getClientPos(e){return e.clientX!==void 0?{x:e.clientX,y:e.clientY}:e.touches&&e.touches.length>0?{x:e.touches[0].clientX,y:e.touches[0].clientY}:e.changedTouches&&e.changedTouches.length>0?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:null}handleStart(e,t){if(this.isTransitioning||this.draggedElement)return;e.preventDefault(),e.stopPropagation();const n=this.getClientPos(e);if(!n)return;this.draggedElement=t,e.target&&e.target.setPointerCapture&&e.target.setPointerCapture(e.pointerId);const s=t.dataset.shape,i=this.shapes.find(o=>o.type===s);i&&p.speak(i.nameFr);const a=t.getBoundingClientRect();this.offsetX=n.x-a.left,this.offsetY=n.y-a.top,this.originalX=a.left,this.originalY=a.top,t.style.position="fixed",t.style.left=a.left+"px",t.style.top=a.top+"px",t.style.zIndex="1000",t.style.width=a.width+"px",t.style.height=a.height+"px",d.playPop(),this.moveHandler=o=>this.handleMove(o),this.endHandler=o=>this.handleEnd(o),document.addEventListener("pointermove",this.moveHandler),document.addEventListener("pointerup",this.endHandler),document.addEventListener("pointercancel",this.endHandler),document.addEventListener("touchmove",this.moveHandler,{passive:!1}),document.addEventListener("touchend",this.endHandler)}handleMove(e){if(!this.draggedElement)return;e.preventDefault();const t=this.getClientPos(e);t&&(this.draggedElement.style.left=t.x-this.offsetX+"px",this.draggedElement.style.top=t.y-this.offsetY+"px")}handleEnd(e){if(!this.draggedElement)return;if(e.target&&e.target.releasePointerCapture&&e.pointerId)try{e.target.releasePointerCapture(e.pointerId)}catch{}document.removeEventListener("pointermove",this.moveHandler),document.removeEventListener("pointerup",this.endHandler),document.removeEventListener("pointercancel",this.endHandler),document.removeEventListener("touchmove",this.moveHandler),document.removeEventListener("touchend",this.endHandler);const t=this.draggedElement.dataset.shape,n=document.querySelectorAll(".shape-target");let s=!1;const i=this.draggedElement.getBoundingClientRect(),a={x:i.left+i.width/2,y:i.top+i.height/2};n.forEach(o=>{if(o.dataset.shape===t&&!o.classList.contains("filled")){const r=o.getBoundingClientRect();a.x>=r.left&&a.x<=r.right&&a.y>=r.top&&a.y<=r.bottom&&(s=!0,this.handleSuccess(o,r))}}),s||this.handleFailure(),this.draggedElement=null}handleSuccess(e,t){if(e.classList.add("filled"),this.score+=20,this.updateScoreDisplay(),p.speakPositive(),d.playSuccess(),this.draggedElement){const n=this.draggedElement.getBoundingClientRect();this.draggedElement.style.left=t.left+(t.width-n.width)/2+"px",this.draggedElement.style.top=t.top+(t.height-n.height)/2+"px",this.draggedElement.style.cursor="default",this.draggedElement.style.pointerEvents="none"}y.burst(t.left+t.width/2,t.top+t.height/2,30),this.matchedCount++,setTimeout(()=>{this.checkLevelComplete()},500)}handleFailure(){d.playThud(),this.draggedElement&&(this.draggedElement.classList.add("bounce-back"),this.draggedElement.style.left=this.originalX+"px",this.draggedElement.style.top=this.originalY+"px",setTimeout(()=>{this.draggedElement&&(this.draggedElement.classList.remove("bounce-back"),this.draggedElement.style.position="",this.draggedElement.style.left="",this.draggedElement.style.top="",this.draggedElement.style.zIndex="",this.draggedElement.style.width="",this.draggedElement.style.height="")},400))}checkLevelComplete(){if(this.matchedCount===this.shapes.length){this.isTransitioning=!0,p.speak("Niveau terminÃ© !");const e=this.container.querySelector(".level-complete-message");e&&(e.classList.add("show"),e.textContent="Bravo!"),d.playSuccess(),y.burstCenter(),setTimeout(()=>{this.advanceLevel()},2500)}}advanceLevel(){this.currentLevel<this.maxLevels?(this.currentLevel++,this.mount(this.container)):this.showCompletionCelebration()}showCompletionCelebration(){p.speak(`Tu as terminÃ© tous les niveaux ! Score final : ${this.score} points !`);const e=document.createElement("div");e.className="completion-celebration",e.innerHTML=`
      <div class="celebration-content">
        <div class="celebration-emoji">ğŸ†</div>
        <div class="celebration-text">Tu as terminÃ© tous les niveaux !</div>
        <div class="celebration-score">Score final : ${this.score}</div>
      </div>
    `,this.container.appendChild(e);for(let t=0;t<5;t++)setTimeout(()=>{y.burst(Math.random()*window.innerWidth,Math.random()*window.innerHeight,40)},t*300);setTimeout(()=>{this.currentLevel=1,this.mount(this.container)},4e3)}updateScoreDisplay(){const e=this.container.querySelector(".score-display"),t=this.container.querySelector(".level-display");e&&(e.textContent=`Score: ${this.score}`),t&&(t.textContent=`Level ${this.currentLevel}`)}cleanup(){this.moveHandler&&(document.removeEventListener("pointermove",this.moveHandler),document.removeEventListener("touchmove",this.moveHandler)),this.endHandler&&(document.removeEventListener("pointerup",this.endHandler),document.removeEventListener("pointercancel",this.endHandler),document.removeEventListener("touchend",this.endHandler)),this.draggedElement=null,this.isTransitioning=!1,super.cleanup()}}class D extends w{constructor(){super({id:"memoryGame",name:"Memory Game",icon:"ğŸƒ"}),this.cards=[],this.flippedCards=[],this.matchedPairs=0,this.canFlip=!0,this.emojis=["ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼"]}mount(e){super.mount(e),this.container.innerHTML="",this.cards=[],this.flippedCards=[],this.matchedPairs=0,this.canFlip=!0;const t=document.createElement("div");t.className="memory-game-wrapper";const n=document.createElement("div");n.className="memory-grid",[...this.emojis,...this.emojis].sort(()=>Math.random()-.5).forEach((a,o)=>{const r=document.createElement("div");r.className="memory-card",r.dataset.emoji=a,r.dataset.index=o;const c=document.createElement("div");c.className="card-front",c.textContent="?";const m=document.createElement("div");m.className="card-back",m.textContent=a,r.appendChild(c),r.appendChild(m);const v=()=>this.flipCard(r);this.addEventListener(r,"click",v),n.appendChild(r),this.cards.push(r)}),t.appendChild(n),this.container.appendChild(t),d.playPop(),p.speak("Trouve les paires!")}flipCard(e){!this.canFlip||e.classList.contains("flipped")||e.classList.contains("matched")||(e.classList.add("flipped"),this.flippedCards.push(e),d.playPop(),this.flippedCards.length===2&&(this.canFlip=!1,this.checkMatch()))}checkMatch(){const[e,t]=this.flippedCards;if(e.dataset.emoji===t.dataset.emoji){e.classList.add("matched"),t.classList.add("matched"),this.matchedPairs++,d.playSuccess(),p.speakPositive();const n=e.getBoundingClientRect();y.burst(n.left+n.width/2,n.top+n.height/2,20),this.flippedCards=[],this.canFlip=!0,this.matchedPairs===this.emojis.length&&setTimeout(()=>{this.celebrate()},500)}else d.playThud(),setTimeout(()=>{e.classList.remove("flipped"),t.classList.remove("flipped"),this.flippedCards=[],this.canFlip=!0},1e3)}celebrate(){p.speak("Bravo! Tu as trouvÃ© toutes les paires!"),y.burstCenter(),setTimeout(()=>{this.mount(this.container)},3e3)}cleanup(){this.cards=[],this.flippedCards=[],super.cleanup()}}class H extends w{constructor(){super({id:"moleGame",name:"Whack-a-Mole",icon:"ğŸ¹"}),this.score=0,this.gameInterval=null,this.holes=[]}mount(e){super.mount(e),this.container.innerHTML="",this.score=0;const t=document.createElement("div");t.className="mole-game-wrapper";const n=document.createElement("div");n.className="mole-score",n.textContent=`Score: ${this.score}`,this.scoreDisplay=n,t.appendChild(n);const s=document.createElement("div");s.className="mole-grid";for(let i=0;i<9;i++){const a=document.createElement("div");a.className="mole-hole";const o=document.createElement("div");o.className="mole",o.textContent="ğŸ¹";const r=()=>this.whackMole(a);this.addEventListener(o,"click",r),a.appendChild(o),s.appendChild(a),this.holes.push(a)}t.appendChild(s),this.container.appendChild(t),this.startGame(),d.playPop(),p.speak("Tape les taupes!")}startGame(){this.gameInterval=setInterval(()=>{this.popRandomMole()},1e3)}popRandomMole(){const e=this.holes.filter(n=>!n.classList.contains("active"));if(e.length===0)return;const t=e[Math.floor(Math.random()*e.length)];t.classList.add("active"),setTimeout(()=>{t.classList.remove("active")},800)}whackMole(e){if(!e.classList.contains("active"))return;e.classList.remove("active"),e.classList.add("whacked"),this.score+=10,this.scoreDisplay.textContent=`Score: ${this.score}`,d.playPop();const t=e.getBoundingClientRect();y.burst(t.left+t.width/2,t.top+t.height/2,15),setTimeout(()=>{e.classList.remove("whacked")},300),this.score%50===0&&(d.playMagicalChime(),p.speakPositive())}cleanup(){this.gameInterval&&(clearInterval(this.gameInterval),this.gameInterval=null),this.holes=[],super.cleanup()}}class R extends w{constructor(){super({id:"drawingPad",name:"Drawing Pad",icon:"ğŸ¨"}),this.canvas=null,this.ctx=null,this.isDrawing=!1,this.currentColor="#000000",this.lineWidth=15,this.isRainbowMode=!1,this.rainbowHue=0,this.colors=[{color:"#ff0000",label:"Red"},{color:"#00ff00",label:"Green"},{color:"#0000ff",label:"Blue"},{color:"#ffff00",label:"Yellow"},{color:"#ff00ff",label:"Purple"}]}mount(e){super.mount(e),this.container.innerHTML="",this.isRainbowMode=!1,this.rainbowHue=0;const t=document.createElement("div");t.className="drawing-container";const n=document.createElement("div");n.className="canvas-wrapper",this.canvas=document.createElement("canvas"),this.canvas.id="drawingCanvas",this.canvas.width=700,this.canvas.height=400,this.resizeCanvas(),this.addEventListener(window,"resize",()=>this.resizeCanvas()),this.ctx=this.canvas.getContext("2d"),this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.lineWidth,this.ctx.strokeStyle=this.currentColor,this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.addDrawingHandlers(),n.appendChild(this.canvas);const s=document.createElement("div");s.className="drawing-controls";const i=document.createElement("div");i.className="color-palette",this.colors.forEach((h,l)=>{const u=document.createElement("button");u.className="color-btn"+(l===0?" active":""),u.style.backgroundColor=h.color,u.setAttribute("aria-label",h.label);const g=()=>this.selectColor(h.color,u);this.addEventListener(u,"click",g),i.appendChild(u)});const a=document.createElement("button");a.className="color-btn rainbow-btn",a.setAttribute("aria-label","Rainbow pencil"),a.innerHTML="ğŸŒˆ";const o=()=>this.toggleRainbowMode(a);this.addEventListener(a,"click",o),i.appendChild(a);const r=document.createElement("button");r.className="color-btn camera-btn",r.innerHTML="ğŸ“·",r.setAttribute("aria-label","Save drawing");const c=()=>this.saveDrawing();this.addEventListener(r,"click",c),i.appendChild(r);const m=document.createElement("button");m.className="clear-btn",m.textContent="ğŸ—‘ï¸",m.setAttribute("aria-label","Clear drawing");const v=()=>this.clearCanvas();this.addEventListener(m,"click",v),i.appendChild(m),s.appendChild(i),t.appendChild(n),t.appendChild(s),this.container.appendChild(t),this.selectColor(this.colors[0].color,i.querySelector(".color-btn"))}resizeCanvas(){if(!this.canvas)return;const e=Math.min(window.innerWidth-80,800),t=Math.min(window.innerHeight-280,450),n=Math.min(e/700,t/400);this.canvas.style.width=700*n+"px",this.canvas.style.height=400*n+"px"}addDrawingHandlers(){const e=r=>this.startDrawing(r,"mouse"),t=r=>this.draw(r,"mouse"),n=()=>this.stopDrawing(),s=()=>this.stopDrawing();this.addEventListener(this.canvas,"mousedown",e),this.addEventListener(this.canvas,"mousemove",t),this.addEventListener(this.canvas,"mouseup",n),this.addEventListener(this.canvas,"mouseleave",s);const i=r=>{r.preventDefault();for(let c=0;c<r.changedTouches.length;c++)this.startDrawing(r.changedTouches[c],"touch")},a=r=>{r.preventDefault();for(let c=0;c<r.changedTouches.length;c++)this.draw(r.changedTouches[c],"touch")},o=r=>{r.preventDefault(),this.stopDrawing()};this.addEventListener(this.canvas,"touchstart",i,{passive:!1}),this.addEventListener(this.canvas,"touchmove",a,{passive:!1}),this.addEventListener(this.canvas,"touchend",o),this.addEventListener(this.canvas,"touchcancel",o)}getCoordinates(e,t){const n=this.canvas.getBoundingClientRect(),s=this.canvas.width/n.width,i=this.canvas.height/n.height,a=e.clientX,o=e.clientY;return{x:(a-n.left)*s,y:(o-n.top)*i}}startDrawing(e,t){this.isDrawing=!0;const n=this.getCoordinates(e,t);this.ctx.beginPath(),this.ctx.moveTo(n.x,n.y),d.playPop()}draw(e,t){if(!this.isDrawing)return;const n=this.getCoordinates(e,t);this.isRainbowMode&&(this.rainbowHue=(this.rainbowHue+2)%360,this.ctx.strokeStyle=`hsl(${this.rainbowHue}, 100%, 50%)`),this.ctx.lineTo(n.x,n.y),this.ctx.stroke()}stopDrawing(){this.isDrawing&&(this.isDrawing=!1,this.ctx.beginPath())}selectColor(e,t){this.isRainbowMode=!1,this.currentColor=e,this.ctx.strokeStyle=e,document.querySelectorAll(".color-btn").forEach(n=>{n.classList.remove("active")}),t.classList.add("active"),d.playPop()}toggleRainbowMode(e){this.isRainbowMode=!this.isRainbowMode,document.querySelectorAll(".color-btn").forEach(t=>{t.classList.remove("active")}),this.isRainbowMode&&e.classList.add("active"),d.playPop()}saveDrawing(){const e=document.createElement("a");e.download=`masterpiece-${Date.now()}.png`,e.href=this.canvas.toDataURL("image/png"),document.body.appendChild(e),e.click(),document.body.removeChild(e),d.playSuccess();const t=this.canvas.getBoundingClientRect();y.burst(t.left+t.width/2,t.top+t.height/2,30)}clearCanvas(){this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),d.playPop();const e=this.canvas.getBoundingClientRect();y.burst(e.left+e.width/2,e.top+e.height/2,15)}cleanup(){this.canvas=null,this.ctx=null,super.cleanup()}}class V extends w{constructor(){super({id:"hungryAnimals",name:"Hungry Animals",icon:"ğŸ½ï¸"}),this.currentLevel=1,this.maxLevels=3,this.score=0,this.draggedFood=null,this.animals=[],this.foods=[],this.matchesCompleted=0,this.animalFoodPairs=[{animal:"ğŸ°",animalName:"Le lapin",animalType:"rabbit",food:"ğŸ¥•",foodName:"la carotte",sound:"crunch"},{animal:"ğŸ¶",animalName:"Le chien",animalType:"dog",food:"ğŸ¦´",foodName:"l'os",sound:"crunch"},{animal:"ğŸµ",animalName:"Le singe",animalType:"monkey",food:"ğŸŒ",foodName:"la banane",sound:"munch"},{animal:"ğŸ±",animalName:"Le chat",animalType:"cat",food:"ğŸŸ",foodName:"le poisson",sound:"crunch"},{animal:"ğŸ¼",animalName:"Le panda",animalType:"panda",food:"ğŸ‹",foodName:"le bambou",sound:"munch"},{animal:"ğŸ¦",animalName:"Le lion",animalType:"lion",food:"ğŸ¥©",foodName:"la viande",sound:"crunch"}]}mount(e){super.mount(e),this.container.innerHTML="",this.score=0,this.matchesCompleted=0,this.animals=[],this.foods=[];const t=document.createElement("div");t.className="hungry-animals-wrapper";const n=document.createElement("div");n.className="hungry-score",n.textContent=`Score: ${this.score}`,this.scoreDisplay=n,t.appendChild(n);const s=document.createElement("div");s.className="hungry-instruction",s.textContent="ğŸ½ï¸ Nourris les animaux!",t.appendChild(s);const i=document.createElement("div");i.className="hungry-animals-area",this.animalsArea=i,t.appendChild(i);const a=document.createElement("div");a.className="hungry-food-area",this.foodArea=a,t.appendChild(a);const o=document.createElement("div");o.className="level-complete-message",t.appendChild(o),this.celebrationMsg=o,this.container.appendChild(t),this.setupLevel(),d.playPop(),p.speak("Nourris les animaux!")}setupLevel(){this.animalsArea.innerHTML="",this.foodArea.innerHTML="",this.animals=[],this.foods=[],this.matchesCompleted=0;const e=this.currentLevel,n=[...this.animalFoodPairs].sort(()=>Math.random()-.5).slice(0,e),s=[...n].sort(()=>Math.random()-.5);n.forEach(i=>{const a=document.createElement("div");a.className="hungry-animal-container",a.dataset.animalType=i.animalType;const o=document.createElement("div");o.className="hungry-animal",o.textContent=i.animal,o.dataset.animalType=i.animalType,o.dataset.foodType=i.food;const r=document.createElement("div");r.className="hungry-animal-label",r.textContent=i.animalName,a.appendChild(o),a.appendChild(r),this.animalsArea.appendChild(a),this.animals.push({element:a,type:i.animalType,food:i.food,pair:i})}),s.forEach(i=>{const a=document.createElement("div");a.className="hungry-food",a.textContent=i.food,a.dataset.foodType=i.food,a.dataset.animalType=i.animalType,this.foodArea.appendChild(a),this.foods.push({element:a,type:i.food,animalType:i.animalType,pair:i}),this.addDragHandlers(a)})}addDragHandlers(e){let t,n,s,i,a=!1;const o=h=>h.clientX!==void 0?{x:h.clientX,y:h.clientY}:h.touches&&h.touches.length>0?{x:h.touches[0].clientX,y:h.touches[0].clientY}:h.changedTouches&&h.changedTouches.length>0?{x:h.changedTouches[0].clientX,y:h.changedTouches[0].clientY}:null,r=h=>{if(h.preventDefault(),this.draggedFood)return;const l=o(h);if(!l)return;a=!0,this.draggedFood=e,t=l.x,n=l.y;const u=e.getBoundingClientRect();if(s=u.left,i=u.top,e.style.position="fixed",e.style.left=s+"px",e.style.top=i+"px",e.style.zIndex="1000",e.style.transform="scale(1.2)",h.target&&h.target.setPointerCapture)try{h.target.setPointerCapture(h.pointerId)}catch{}d.playPop()},c=h=>{if(!a||!this.draggedFood||this.draggedFood!==e)return;const l=o(h);if(!l)return;const u=l.x-t,g=l.y-n;e.style.left=s+u+"px",e.style.top=i+g+"px"},m=h=>{if(!a||!this.draggedFood||this.draggedFood!==e)return;if(a=!1,h.target&&h.target.releasePointerCapture&&h.pointerId)try{h.target.releasePointerCapture(h.pointerId)}catch{}const l=e.getBoundingClientRect(),u={x:l.left+l.width/2,y:l.top+l.height/2};let g=!1,x=null;this.animals.forEach(T=>{if(T.element.classList.contains("fed"))return;const E=T.element.getBoundingClientRect();u.x>=E.left&&u.x<=E.right&&u.y>=E.top&&u.y<=E.bottom&&(x=T,T.type===e.dataset.animalType&&(g=!0))}),g?this.handleSuccess(e,x):x?this.handleFailure(e,x):this.returnFood(e),this.draggedFood=null};this.addEventListener(e,"pointerdown",r),this.addEventListener(document,"pointermove",c),this.addEventListener(document,"pointerup",m),this.addEventListener(document,"pointercancel",m);const v=h=>{h.preventDefault(),r(h)};this.addEventListener(e,"touchstart",v,{passive:!1}),this.addEventListener(document,"touchmove",c,{passive:!1}),this.addEventListener(document,"touchend",m),this.addEventListener(document,"touchcancel",m)}handleSuccess(e,t){t.element.classList.add("fed"),this.score+=20,this.updateScoreDisplay(),d.playSuccess();const n=`${t.pair.animalName} mange ${t.pair.foodName}!`;p.speak(n);const s=t.element.getBoundingClientRect();e.style.left=s.left+(s.width-80)/2+"px",e.style.top=s.top+20+"px",e.style.zIndex="100",e.style.transform="scale(0.8)",t.element.querySelector(".hungry-animal").classList.add("eating"),y.burst(s.left+s.width/2,s.top+s.height/2,30),this.showHearts(t.element),setTimeout(()=>{e.style.opacity="0",e.style.transform="scale(0)",setTimeout(()=>{e.remove()},300)},1500),this.matchesCompleted++,setTimeout(()=>{this.checkLevelComplete()},2e3)}handleFailure(e,t){d.playThud();const n=t.element.querySelector(".hungry-animal");n.classList.add("head-shake"),e.classList.add("bounce-back"),setTimeout(()=>{n.classList.remove("head-shake"),e.classList.remove("bounce-back"),this.returnFood(e)},600)}returnFood(e){e.style.position="absolute",e.style.left="",e.style.top="",e.style.zIndex="",e.style.transform="scale(1)"}showHearts(e){for(let t=0;t<3;t++)setTimeout(()=>{const n=document.createElement("div");n.className="hungry-heart",n.textContent="â¤ï¸",n.style.left=20+Math.random()*60+"%",n.style.top="0%",e.appendChild(n),setTimeout(()=>{n.remove()},1500)},t*200)}checkLevelComplete(){this.matchesCompleted===this.currentLevel&&(this.currentLevel<this.maxLevels?(this.celebrationMsg.textContent="Level Complete!",this.celebrationMsg.classList.add("show"),p.speak("Bravo! Niveau suivant!"),y.burstCenter(),setTimeout(()=>{this.celebrationMsg.classList.remove("show"),this.currentLevel++,this.setupLevel()},2500)):this.showFinalCelebration())}showFinalCelebration(){const e=document.createElement("div");e.className="completion-celebration",e.innerHTML=`
      <div class="celebration-content">
        <div class="celebration-emoji">ğŸ†</div>
        <div class="celebration-text">Tous les animaux sont nourris!</div>
        <div class="celebration-score">Score: ${this.score}</div>
      </div>
    `,this.container.appendChild(e),p.speak(`FÃ©licitations! Tu as nourri tous les animaux! Score final: ${this.score} points!`);for(let t=0;t<5;t++)setTimeout(()=>{y.burst(Math.random()*window.innerWidth,Math.random()*window.innerHeight,40)},t*300);setTimeout(()=>{this.currentLevel=1,this.score=0,this.mount(this.container)},4e3)}updateScoreDisplay(){this.scoreDisplay&&(this.scoreDisplay.textContent=`Score: ${this.score}`)}cleanup(){this.draggedFood=null,this.animals=[],this.foods=[],super.cleanup()}}class G{constructor(){this.games=new Map,this.currentGame=null,this.container=null,this.menuContainer=null}init(){d.init(),p.init(),y.init(),this.createAppStructure(),this.registerGame(new F),this.registerGame(new k),this.registerGame(new N),this.registerGame(new B),this.registerGame(new P),this.registerGame(new D),this.registerGame(new H),this.registerGame(new R),this.registerGame(new V),this.setupEventListeners(),this.showMenu()}createAppStructure(){const e=document.getElementById("app");e.innerHTML=`
      <div class="menu-screen" id="menuScreen">
        <h1 class="game-title">ğŸ® Jeux pour Tout-Petits</h1>
        <div class="games-grid" id="gamesGrid"></div>
        <div class="scroll-hint">ğŸ‘† Tape pour jouer!</div>
      </div>
      
      <div class="game-container hidden" id="gameContainer"></div>
      
      <button class="home-button hidden" id="homeButton">ğŸ </button>
      <button class="mute-button" id="muteButton">${C.getState().isMuted?"ğŸ”‡":"ğŸ”Š"}</button>
    `,this.menuContainer=document.getElementById("menuScreen"),this.container=document.getElementById("gameContainer"),C.subscribe("isMuted",t=>{document.getElementById("muteButton").textContent=t?"ğŸ”‡":"ğŸ”Š"})}registerGame(e){this.games.set(e.id,e),this.addGameCard(e)}addGameCard(e){const t=document.getElementById("gamesGrid"),n=document.createElement("button");n.className="game-card",n.dataset.game=e.id,n.innerHTML=`<span class="game-icon">${e.icon}</span>`,n.addEventListener("click",()=>this.startGame(e.id)),t.appendChild(n)}setupEventListeners(){document.getElementById("homeButton").addEventListener("click",()=>{this.showMenu()}),document.getElementById("muteButton").addEventListener("click",()=>{const e=C.getState().isMuted;C.setState({isMuted:!e}),d.playPop()}),document.addEventListener("click",()=>{p.unlock()},{once:!0})}startGame(e){const t=this.games.get(e);if(!t){console.error("Game not found:",e);return}this.currentGame&&this.currentGame.unmount(),window.scrollTo(0,0),this.menuContainer.classList.add("hidden"),this.container.classList.remove("hidden"),document.getElementById("homeButton").classList.remove("hidden"),document.querySelector(".scroll-hint").classList.add("hidden"),this.container.innerHTML="",t.mount(this.container),this.currentGame=t,C.setState({currentGame:e}),d.playPop()}showMenu(){this.currentGame&&(this.currentGame.unmount(),this.currentGame=null),this.menuContainer.classList.remove("hidden"),this.container.classList.add("hidden"),this.container.innerHTML="",document.getElementById("homeButton").classList.add("hidden"),document.querySelector(".scroll-hint").classList.remove("hidden"),C.setState({currentGame:null}),d.playPop()}}document.addEventListener("DOMContentLoaded",()=>{new G().init()});
